{"ast":null,"code":"import React from'react';import{Grid,Button,Paper,IconButton,Box,Typography}from'@material-ui/core';import{Delete}from'@material-ui/icons';import axios from'axios';import Swal from'sweetalert2';import{useForm,Controller}from'react-hook-form';import{useBoolean,useInmutableFetch}from'hooks';import{LoadingButton,InputFile}from'components';// import Formulario from 'views/Components/Digitacion/Formulario'\nimport{UploadFilesSchema,defaultUploadFiles}from'./UploadFiles.schema';const UploadFiles=_ref=>{let{nextStep,backStep,id}=_ref;const{data}=useInmutableFetch(id?`/api/SolicitudesTramites/${id}`:null);const values={...defaultUploadFiles};const disabled=!!data.documentos_anexos;if(data.documentos_anexos){console.log(Object.values(JSON.parse(data.documentos_anexos)));values.documentos=Object.values(JSON.parse(data.documentos_anexos)).filter(item=>typeof item==='string').map(document=>({name:document}));}const{control,handleSubmit,reset,watch,formState:{errors}}=useForm({resolver:UploadFilesSchema,defaultValues:{...values}});const documentos=watch('documentos');const[loading,handleLoading]=useBoolean(false);const onSubmit=async form=>{if(disabled){nextStep({});}else{const formData=new FormData();form.documentos.forEach(document=>{formData.append('documentos[]',document);});handleLoading(true);try{const{data}=await axios.post(`/api/SolicitudesTramites/estadoTres/${id}`,formData);nextStep(data);}catch(error){Swal.fire({icon:'error',title:'Error',text:'Tuvimos un error, validate los datos y intente nuevamente'});}handleLoading(false);}};const deleteDocument=idx=>{const newDocuments=[...documentos];newDocuments.splice(idx,1);reset({documentos:newDocuments});};return/*#__PURE__*/React.createElement(\"form\",{noValidate:true,onSubmit:handleSubmit(onSubmit)},/*#__PURE__*/React.createElement(Grid,{container:true,spacing:3},/*#__PURE__*/React.createElement(Grid,{item:true,xs:12},/*#__PURE__*/React.createElement(Controller,{name:\"documentos\",control:control,render:_ref2=>{let{field}=_ref2;return/*#__PURE__*/React.createElement(InputFile,{disabled:disabled,onChange:(e,files)=>{field.onChange({target:{name:field.name,value:[...documentos,...files]}});},error:!!errors.documentos,helperText:errors.documentos?errors.documentos.message:`Formatos válidos: Imagen (jpg, jpeg, gif, png), Texto (xls, xlsx, doc, docx, pdf), compresión de archivos (zip, rar). 3 archivos máximo, para más documentos subirlos en un .zip/.rar`});}})),/*#__PURE__*/React.createElement(Grid,{container:true,item:true,xs:12,spacing:3},documentos.map((_ref3,idx)=>{let{name}=_ref3;return/*#__PURE__*/React.createElement(Grid,{key:name,item:true,xs:\"auto\"},/*#__PURE__*/React.createElement(Box,{variant:\"outlined\",display:\"flex\",component:Paper,justifyContent:\"space-between\",alignItems:\"center\",p:1.5},/*#__PURE__*/React.createElement(Typography,{variant:\"caption\"},name),/*#__PURE__*/React.createElement(IconButton,{style:{marginLeft:8},size:\"small\",color:\"secondary\",disabled:disabled,onClick:()=>deleteDocument(idx)},/*#__PURE__*/React.createElement(Delete,{fontSize:\"small\"}))));})),/*#__PURE__*/React.createElement(Grid,{item:true},/*#__PURE__*/React.createElement(Button,{disabled:loading,color:\"secondary\",variant:\"contained\",size:\"small\",onClick:backStep},\"Atras\")),/*#__PURE__*/React.createElement(Grid,{item:true},/*#__PURE__*/React.createElement(LoadingButton,{loading:loading,type:\"submit\",color:\"secondary\",variant:\"contained\",size:\"small\"},\"Continuar\"))));};export default UploadFiles;","map":{"version":3,"names":["React","Grid","Button","Paper","IconButton","Box","Typography","Delete","axios","Swal","useForm","Controller","useBoolean","useInmutableFetch","LoadingButton","InputFile","UploadFilesSchema","defaultUploadFiles","UploadFiles","_ref","nextStep","backStep","id","data","values","disabled","documentos_anexos","console","log","Object","JSON","parse","documentos","filter","item","map","document","name","control","handleSubmit","reset","watch","formState","errors","resolver","defaultValues","loading","handleLoading","onSubmit","form","formData","FormData","forEach","append","post","error","fire","icon","title","text","deleteDocument","idx","newDocuments","splice","createElement","noValidate","container","spacing","xs","render","_ref2","field","onChange","e","files","target","value","helperText","message","_ref3","key","variant","display","component","justifyContent","alignItems","p","style","marginLeft","size","color","onClick","fontSize","type"],"sources":["C:/Users/HUAWEI/Documents/GitHub/SinfonyPlataforma/src/views/Process/CreateProcess/components/UploadFiles/UploadFiles.jsx"],"sourcesContent":["import React from 'react'\r\n\r\nimport { Grid, Button, Paper, IconButton, Box, Typography } from '@material-ui/core'\r\n\r\nimport { Delete } from '@material-ui/icons'\r\n\r\nimport axios from 'axios'\r\nimport Swal from 'sweetalert2'\r\nimport PropTypes from 'prop-types'\r\nimport { useForm, Controller } from 'react-hook-form'\r\n\r\nimport { useBoolean, useInmutableFetch } from 'hooks'\r\nimport { LoadingButton, InputFile } from 'components'\r\n// import Formulario from 'views/Components/Digitacion/Formulario'\r\n\r\nimport { UploadFilesSchema, defaultUploadFiles } from './UploadFiles.schema'\r\n\r\nconst UploadFiles = ({ nextStep, backStep, id }) => {\r\n  const { data } = useInmutableFetch(id ? `/api/SolicitudesTramites/${id}` : null)\r\n\r\n  const values = { ...defaultUploadFiles }\r\n\r\n  const disabled = !!data.documentos_anexos\r\n\r\n  if (data.documentos_anexos) {\r\n    console.log(Object.values(JSON.parse(data.documentos_anexos)))\r\n    values.documentos = Object.values(JSON.parse(data.documentos_anexos))\r\n      .filter(item => typeof item === 'string')\r\n      .map(document => ({ name: document }))\r\n  }\r\n\r\n  const {\r\n    control,\r\n    handleSubmit,\r\n    reset,\r\n    watch,\r\n    formState: { errors },\r\n  } = useForm({\r\n    resolver: UploadFilesSchema,\r\n    defaultValues: { ...values },\r\n  })\r\n\r\n  const documentos = watch('documentos')\r\n\r\n  const [loading, handleLoading] = useBoolean(false)\r\n\r\n  const onSubmit = async form => {\r\n    if (disabled) {\r\n      nextStep({})\r\n    } else {\r\n      const formData = new FormData()\r\n\r\n      form.documentos.forEach(document => {\r\n        formData.append('documentos[]', document)\r\n      })\r\n\r\n      handleLoading(true)\r\n      try {\r\n        const { data } = await axios.post(`/api/SolicitudesTramites/estadoTres/${id}`, formData)\r\n        nextStep(data)\r\n      } catch (error) {\r\n        Swal.fire({\r\n          icon: 'error',\r\n          title: 'Error',\r\n          text: 'Tuvimos un error, validate los datos y intente nuevamente',\r\n        })\r\n      }\r\n      handleLoading(false)\r\n    }\r\n  }\r\n\r\n  const deleteDocument = idx => {\r\n    const newDocuments = [...documentos]\r\n    newDocuments.splice(idx, 1)\r\n    reset({ documentos: newDocuments })\r\n  }\r\n\r\n  return (\r\n    <form noValidate onSubmit={handleSubmit(onSubmit)}>\r\n      <Grid container spacing={3}>\r\n        <Grid item xs={12}>\r\n          <Controller\r\n            name=\"documentos\"\r\n            control={control}\r\n            render={({ field }) => {\r\n              return (\r\n                <InputFile\r\n                  disabled={disabled}\r\n                  onChange={(e, files) => {\r\n                    field.onChange({ target: { name: field.name, value: [...documentos, ...files] } })\r\n                  }}\r\n                  error={!!errors.documentos}\r\n                  helperText={\r\n                    errors.documentos\r\n                      ? errors.documentos.message\r\n                      : `Formatos válidos: Imagen (jpg, jpeg, gif, png), Texto (xls, xlsx, doc, docx, pdf), compresión de archivos (zip, rar). 3 archivos máximo, para más documentos subirlos en un .zip/.rar`\r\n                  }\r\n                />\r\n              )\r\n            }}\r\n          />\r\n        </Grid>\r\n\r\n        <Grid container item xs={12} spacing={3}>\r\n          {documentos.map(({ name }, idx) => (\r\n            <Grid key={name} item xs=\"auto\">\r\n              <Box\r\n                variant=\"outlined\"\r\n                display=\"flex\"\r\n                component={Paper}\r\n                justifyContent=\"space-between\"\r\n                alignItems=\"center\"\r\n                p={1.5}\r\n              >\r\n                <Typography variant=\"caption\">{name}</Typography>\r\n                <IconButton\r\n                  style={{ marginLeft: 8 }}\r\n                  size=\"small\"\r\n                  color=\"secondary\"\r\n                  disabled={disabled}\r\n                  onClick={() => deleteDocument(idx)}\r\n                >\r\n                  <Delete fontSize=\"small\" />\r\n                </IconButton>\r\n              </Box>\r\n            </Grid>\r\n          ))}\r\n        </Grid>\r\n\r\n        <Grid item>\r\n          <Button disabled={loading} color=\"secondary\" variant=\"contained\" size=\"small\" onClick={backStep}>\r\n            Atras\r\n          </Button>\r\n        </Grid>\r\n        <Grid item>\r\n          <LoadingButton loading={loading} type=\"submit\" color=\"secondary\" variant=\"contained\" size=\"small\">\r\n            Continuar\r\n          </LoadingButton>\r\n        </Grid>\r\n      </Grid>\r\n    </form>\r\n  )\r\n}\r\n\r\nUploadFiles.propTypes = {\r\n  id: PropTypes.string.isRequired,\r\n  nextStep: PropTypes.func.isRequired,\r\n  backStep: PropTypes.func.isRequired,\r\n}\r\n\r\nexport default UploadFiles\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}